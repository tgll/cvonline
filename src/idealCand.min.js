var DbEn = {
  "skills": {
    "title": "Skills",
    "titleSingular": "skills",
    "titlePlural": "skills",
    "maxSelected": 3,
    "data": [{
      "title": "Machine Learning", 
      "ico": "ml",
      "percent": 88,
      "desc": "With my background in maths and computer sciences, machine learning was a logic path to apply my knowledge. I worked at <a href=\"https://www.fieldbox.ai/\" target=\"_blank\">Fieldbox.ai</a> delivering a Machine Learning librairy providing tools and environnement to data scientists, and ease the deployment of AI agents for industrial applications in the Fieldbox platform. But also customise Computer Vision algorithms adapted to industrial purposes. Before that I was at <a href=\"https://www.inria.fr/en/\" target=\"_blank\">INRIA</a> in <a href=\"https://flowers.inria.fr\" target=\"_blank\">Team FLOWERS</a> where I could discover about robotics, exploration algorithms, reinforcement learning, and participate to <a href=\"https://project.inria.fr/paiss\" target=\"_blank\">PAISS</a> Conference."
    }, {
      "title": "Human Computer Interactions", 
      "ico": "HCI",
      "percent": 95,
      "desc": "My master degree permitted me to acquire a broad view of Human Computer Interactions with theoritical courses and applied projects such as <a href=\"https://github.com/tgll/vases-voices/blob/master/VasesVoices_GILLIARD.pdf\" target=\"_blank\">Vases Voices</a> or the <a href=\"https://github.com/tgll/sand-mirror/blob/master/PersonalReflectionGroup6_TallulahGILLIARD.pdf\" target=\"_blank\">Sand Mirror</a>. From interactive and multimodal interactions, mixed reality and tangibles interfaces and apply it through gesture, motion, haptic, VR, or e-textile applications, there's a lot of possibilities of applications in research and industry. I also worked at <a href=\"https://www.ultrahaptics.com/\" target=\"_blank\">Ultrahaptics</a> in the <a href=\"http://interact-lab.com/\" target=\"_blank\">Interact Lab</a> on an haptic board simulating touch with ultrasounds permitting to manipulate virtual objects."
    }, {
      "title": "Mathematics", 
      "ico": "maths",
      "percent": 76, 
      "desc": "I think mathematics are beautiful and useful tools. I studied algebra, analysis, dynamics systems, euclidian spaces, linear and non linear methods or biomathematics in my bachelor of applied maths. I am used to work with statisticals models applied in machine learning. I also woked on wavelengths behaviors throught physical simulations (COMSOL multiphysics software) in my internship at <a href=\"https://www.ultrahaptics.com/\" target=\"_blank\">Ultrahaptics</a> in the <a href=\"http://interact-lab.com/\" target=\"_blank\">Interact Lab</a> in Brighton (paper on <a href=\"https://bit.ly/2P2JVvW\" target=\"_blank\">Acoustic Metasurfaces</a> and paper on <a href=\"https://go.nature.com/2ABieBB\" target=\"_blank\">Metamaterial bricks</a>)."
    }, {
      "title": "Computer sciences", 
      "ico": "info",
      "percent": 85, 
      "desc": "During my education, I studied python, java, processing, raspberry / arduino programing and a bit of databases, web programming, C# (Unity, Vuforia) and C++ (applied to haptics). I practised python since working at <a href=\"https://www.ultrahaptics.com/\" target=\"_blank\">Ultrahaptics</a> on pysical wave simulations, then worked on robotics at <a href=\"https://www.inria.fr/en/\" target=\"_blank\">INRIA</a> and lastly I was involved in the core developement of a python library and computer vision algorithms at <a href=\"https://www.fieldbox.ai/\" target=\"_blank\">Fieldbox.ai</a>. I also have been involved two years in the association <a href=\"https://djangogirls.org\" target=\"_blank\">Django Girls</a>  to teach web programing to women."
    }, {
      "title": "Tangible Interfaces", 
      "ico": "TUI",
      "percent": 87, 
      "desc": "Tangible Interfaces permit users to interact with digital information through physical environment. It combines computer sciences for the technical realisation, and cognitive sciences knowledge about human body, biology and psychology. At <a href=\"https://www.ultrahaptics.com/\" target=\"_blank\">Ultrahaptics</a>, I worked on an haptic interface made of ultrasounds similar to a \"tangible hologram\". In the <a href=\"https://team.inria.fr/potioc/\" target=\"_blank\">Potioc Team</a> (<a href=\"https://www.inria.fr/en/\" target=\"_blank\">INRIA</a>) I worked on the <a href=\"http://hacketafac.u-bordeaux.fr/projets/erlen-project//\" target=\"_blank\">Erlen Project</a>, a tangible and ambient interface that help realize the energy consumption of a user with data visualisation. Then some of my class projects were focusing on tangible interfaces : <a href=\"https://github.com/tgll/vases-voices/blob/master/VasesVoices_GILLIARD.pdf\" target=\"_blank\">Vases Voices</a> (ambiant musical and tactile device), <a href=\"https://github.com/tgll/sand-mirror\" target=\"_blank\">Sand Mirror</a> (remotely controlled interactive device)."
    }, {
      "title": "Statistics", 
      "ico": "stats",
      "percent": 79, 
      "desc": "During my bachelor of applied maths and cognitive sciences, I studied descriptive and inferential statistics, surveys and data analysis through courses and exercises, but also used tools such as R and python on projects like an <a href=\"https://github.com/tgll/tgll.github.io/blob/master/files/projects/stats/EetS_GILLIARD2014.pdf\" target=\"_blank\">analysis of an INSEE french citizen dataset</a>, <a href=\"https://github.com/tgll/tgll.github.io/blob/master/files/projects/stats/EtudedeCasR_GILLIARD2015.pdf\" target=\"_blank\">chi and variance analysis on two datasets</a>, and a <a href=\"https://github.com/tgll/tgll.github.io/blob/master/files/projects/stats/Statistical%20Analysis%20use%20case.ipynb\" target=\"_blank\">dataset analysis with variable predictions</a>. I then have reused that knowledge by working in machine learning contextes and on projects."
    }, {
      "title": "Cognitive sciences", 
      "ico": "cogsci",
      "percent": 85,
      "desc": "I studied Cognitive Sciences through neurosciences (neuroanatomy, neurbiology, cognitive psychology) linguistics, philosophy and ergonomy. This foster my strong interest for the topic and I got involved in the local association (<a href=\"https://www.facebook.com/Ascoergo/\" target=\"_blank\">Ascoergo</a>) by organising events and workshops and then to the national association of students in cognitive sciences (<a href=\"https://federationfresco.fr/\" target=\"_blank\">FRESCO</a>) where we wrote a <a href=\"https://twitter.com/AssoFRESCO/status/909702672739168256\" target=\"_blank\">guide</a> dedicated to cognitive sciences students."
    }, {
      "title": "Robotics", 
      "ico": "robo",
      "percent": 75, 
      "desc": "I have done my master thesis internship at <a href=\"https://flowers.inria.fr\" target=\"_blank\">INRIA</a> (Institut National de Recherche en Informatique et en Automatique) in the <a href=\"https://flowers.inria.fr\" target=\"_blank\">FLOWERS Team</a>, working on curiosity, learning and developement models through humans, robots and algorithms. I was working on Educational Robotics for the  <a href=\"https://www.poppy-project.org/fr\" target=\"_blank\">Poppy Project</a> and I built and programmed a variation of the Poppy Ergo Jr : the <a href=\"https://github.com/tgll/poppy-dragster-mini\" target=\"_blank\">Dragster Mini</a> (link to my github) that we then tested with highschool students. During my master degree I also worked with <a href=\"https://furhatrobotics.com/\" target=\"_blank\">Furhat Robotics</a>."
    }, {
      "title": "Research", 
      "ico": "rsrch",
      "percent": 91, 
      "desc": "Beeing in a constant dialogue with university and researchers working on innovative topics (Inria Bordeaux and Paris-Saclay, Labri Bordeaux, IMN Bordeaux, INTERACT Lab Sussex, IRCAM Paris, Media Lab KTH Stockholm, …) and working in a lab as an intern leads me to have a critical comprehesion and a technological watch regarding new works in research and innovation (reading/writing of scientific articles, conferences, experimental protocoles,  paper deadlines, references management, using LaTex, ..)"
    }, {
      "title": "Design", 
      "ico": "desgn",
      "percent": 78, 
      "desc": "During my master, through projects and workshops, we studied and applied conceptual design theories (Don Norman, Gibson, instrumental interaction), design processes (participatory design, iterative and brainstorming techniques, inspiration/ideation/implementation) and visualisations (dataviz, sketches, moodboards)"
    }]
  },
  "qualifs": {
    "title": "Qualities",
    "titleSingular": "qualities",
    "titlePlural": "qualities",
    "maxSelected": 2,
    "data": [{
      "title": "Creativity", 
      "ico": "crea",
      "percent": 100,
      "desc": "Staying curious about science, about everything new and unknown, about discoveries and technology, then marvel at art, cinema, illustrations, litterature, it permits to keep a creative spirit with always a backup idea in a small corner of your mind."
    }, {
      "title": "Energetic", 
      "ico": "nrj",
      "percent": 100,
      "desc": "I try as much as possible to be in a mood of self challenging, that can be for sports (martial arts, surf, skate, climbing) or in intellectual challenges, that's what drives my daily basis motivation ! I'm not afraid of difficulty, I'm stimulated by it."
    }, {
      "title": "Passionate", 
      "ico": "passio",
      "percent": 100,
      "desc": "I like to think that beeing passionate is a collective work. By learning from others and understanding their point of view, it will inspire you, then it will be your turn to make hatch ideas and transmit your passion with your energy. That's why I've been involved in different associations like Ascoergo, FRESCO, Mindlabdx, TEDxUniversitéDeBordeaux and DjangoGirls."
    }, {
      "title": "Overview", 
      "ico": "ovvw",
      "percent": 100,
      "desc": "Having a pluridisciplinary background (maths, computer science, neurociences, HCI, research, business) helps me to keep in mind different perspectives and arrange elements that could be involved in a project."
    }, {
      "title": "Critical Spirit", 
      "ico": "crit",
      "percent": 100,
      "desc": "By being in touch with two very different worlds: the one of research, full of scientific verification and precision and the one of business and entreupreuneurship, where pitching, spirit of competition and even combativity are crucials, all of that helped me to a more general view about each one vision and objectives."
    }, {
      "title": "Humor", 
      "ico": "jk",
      "percent": 100,
      "desc": "How does a penguin build it's house? Igloos it together."
    }]
  },
  "bonus": {
    "title": "And a bonus",
    "titleSingular": "bonus",
    "titlePlural": "bonus",
    "maxSelected": 1,
    "data": [{
      "title": "Language geek", 
      "ico": "lingu",
      "percent": 100,
      "desc": "French is my native language and I'm fluent in english (master degree in english, internships and year abroad (UK and Sweden), toeic score in 2017 : 825/990). Then I'm really passionate about linguistics and how languages have appeared. I learned Japanese during 7 years (level B1), Spanish 5 years (level B2), Swedish (1 year) and more to come and consolidate !"
    }, {
      "title": "Alternative Music", 
      "ico": "zik",
      "percent": 100,
      "desc": "I love learning about history of music and how genre have appeared. I am curious about any weird, obscur, cool or niche genre that exists and always up to discover a new artist. I also used to be a dj for (very) small events !"
    }, {
      "title": "Art & Comics", 
      "ico": "bd",
      "percent": 100,
      "desc": "I love going to art museums, art is always a great inspiration for techological ideas and they are always calm places to chill and open your mind. I also really enjoy comics, I go to <a href=\"https://www.bdangouleme.com/\" target=\"_blank\"> Angouleme comic festival</a> (festival de la BD) every year since I'm 7 ! When I was a kid I was even doing <a href=\"http://supermoi.blogspot.com\" target=\"_blank\">comic books</a> that I was selling at the local book shop ! I kept that love for drawing."
    }, {
      "title": "Asphalt & Wave Rider", 
      "ico": "sk8",
      "percent": 100,
      "desc": "When I'm far from an ocean or when there is no waves, I'm skateboarding. My next goal is to be able to jump over a pavement or some small stairs. I also do climbing with friends on my free time and martial arts since I'm 13."
    }, {
      "title": "Spinach lover", 
      "ico": "epinar",
      "percent": 100,
      "desc": "I just love spinach : Spinach salad, spinach pie, spinach with cream spinach soup, spinach smoothie, spinach lasagna, spinach and ricotta ravioli..."
    }, {
      "title": "Fashiontech", 
      "ico": "fash",
      "percent": 100,
      "desc": "Clothes and textiles are a great medium for self expression. I like to sew and transform thrifted fabrics, I am also really passionate by the work of some fashion designer like Clara Daguin, Behnaz Farahi, Lucy McRae or Maiko Takeda, they combine technology and fabric in an innovative and poetic way."
    }]
  }
};

// NOT UPDATED
var DbFr = {
  "skills": {
    "title": "Compétences",
    "titleSingular": "compétence",
    "titlePlural": "compétences",
    "maxSelected": 3,
    "data": [{
      "title": "Interfaces Hommes Machines",
      "ico": "HCI",
      "percent": 95,
      "desc": "Mon master m'as permis d'avoir une vue générale des Interactions Homme-Machine et de leur design, des interfaces interactives et multimodales , de la réalité mixte, des interfaces tangibles ansi que leur applications utilisant de la detection de mouvements, des techniques haptiques, de VR/AR, ou de e-textiles."
    }, {
      "title": "Interfaces Tangible",
      "ico": "TUI",
      "percent": 85,
      "desc": "J'ai fait un stage de 4 mois sur un projet d'<a href=\"https://www.ultrahaptics.com/\" target=\"_blank\">Ultrahaptics</a>, une interface haptique faite d'ultrasons, un peu comme un hologramme tangible. Les projets de classe de mon Master m'ont aussi amenés à travailler sur les interfaces tangibles comme dans ce projet de <a href=\"https://goo.gl/br42x1\" target=\"_blank\">vase musical </a>."
    }, {
      "title": "Informatique",
      "ico": "info",
      "percent": 80,
      "desc": "Pendant mon année d'IUT informatique et mon master Informatique Design d'Interfaces Hommes Machine, j'ai programmé en java, python, processing et arduino ansi qu'un peu de bases de données, de programation web et de C#. J'ai pu egalement mettre en pratique mes compétences en python dans mon stage à Brighton sur un projet d'<a href=\"https://www.ultrahaptics.com/\" target=\"_blank\">Ultrahaptics</a>. J'ai aussi été coach pendant deux ans dans l'association Django Girls pour apprendre les bases de la programmation web à des filles débutantes."
    }, {
      "title": "Mathématiques",
      "ico": "maths",
      "percent": 70,
      "desc": "J'ai étudié les mathematiques appliquées pendant ma Licence Maths Informatique Appliquées aux Sciences Humaines et Sociales (espace euclidiens, analyse, systèmes dynamiques, méthodes linéaires et non linéaires). J'ai aussi travaillé sur l'implémentation d'équations physiques (ondes) avec python et COMSOL (logiciel de simulations physiques) durant mon stage dans le labo InteractLab à Brighton (<a href=\"https://bit.ly/2P2JVvW\" target=\"_blank\">paper link 1</a> and <a href=\"https://go.nature.com/2ABieBB\" target=\"_blank\">paper link 2</a>)."
    }, {
      "title": "Sciences Cognitives",
      "ico": "cogsci",
      "percent": 85,
      "desc": "J'ai étudié les Sciences Cognitives au travers de la neuroscience (neuroanatomie, neurbiologie, psychologie cognitive), de la linguistique, de la philosophie et de l'ergonomie. Cela a developpé un fort intérêt pour le sujet et je me suis impliquée dans l'association locale de sciences cognitives de Bordeaux (Ascoergo) en organisant des évenements et workshops, puis dans l'association nationale des etudiants en sciences cognitive (FRESCO) où nous avons réalisé un <a href=\"https://twitter.com/AssoFRESCO/status/909702672739168256\" target=\"_blank\">guide</a> pour les etudiants en sciences cognitive."
    }, {
      "title": "Statistiques",
      "ico": "stats",
      "percent": 75,
      "desc": "En licence de Mathématiques Appliqués aux Sciences Cognitives, les statistiques étaient le pont entre maths (régression linéaire, anova, stat inférentielle, sondages..) et recherche appliquée; cela m'a permis d'utiliser des outils informatiques tels que R ou Python."
    }, {
      "title": "Recherche",
      "ico": "rsrch",
      "percent": 85,
      "desc": "Etre en contact regulier avec des chercheurs (Inria, Labri, IMN…) travaillant sur des sujets novateurs m'a permis une fluidité dans la veille, la compréhension et l'esprit critique, face au monde de la recherche et innovation (articles et conférences scientifiques, protocoles expérimentaux, utilisation de matériel, ..)"
    }, {
      "title": "Design",
      "ico": "desgn",
      "percent": 80,
      "desc": "Au cours du master, à travers des projets et workshops (comme <a href=\"https://goo.gl/jAGjKs\" target=\"_blank\">SimpleSktch_/</a> ou <a href=\"https://goo.gl/81X7ou\" target=\"_blank\">Sand Mirror</a>), j'ai étudié et mis en oeuvre des théories du design (Don Norman, Gibson, interaction instrumentale, ..) et appris à utilier des procédés de design (participatory design, techniques itératives et brainstorming , inspiration/idéation/implémentation, ..)"
    }, {
      "title": "Business & Entrepreneurship",
      "ico": "biz",
      "percent": 65,
      "desc": "Mon master consiste en une majeure d'informatique et une mineure d'entrepreneuriat. En plus des cours à Paris en partenariat avec l'accélérateur The Cantillon, j'ai eu l'opportunité de participer à un \"business kick off\" à Helsinki sur 3 jours de workshop et à une \"Summer School\" de deux semaines à Lisbonne sur le thème d'entrepreneuriat et santé."
    }, {
      "title": "Machine Learning",
      "ico": "ml",
      "percent": 50,
      "desc": "Je n'ai eu que quelques cours et projets sur la régression linéaire, les arbres de décision et les algorithmes génétiques (Neural Networks : Perceptron, RBF) et la ré utilisation de codes de reconaissance de mouvements, mais ce sont des centres d'intérêt que je souhaite développer en auto apprentissage."
    }]
  },
  "qualifs": {
    "title": "Qualités",
    "titleSingular": "qualité",
    "titlePlural": "qualités",
    "maxSelected": 2,
    "data": [{
      "title": "Créative",
      "ico": "crea",
      "percent": 100,
      "desc": "Rester curieuse à propos de sciences, de tout ce qui est nouveau et inconnu, des découvertes et avancées technologiques, puis s'émerveiller d'art, de cinéma, de bande dessinées, de littérature, me permet d'entretenir un esprit créatif, avec toujours une petite idée dans un coin de la tête permettant de sortir des sentiers battus."
    }, {
      "title": "Energique",
      "ico": "nrj",
      "percent": 100,
      "desc": "J'essaie le plus que possible d'être dans une démarche de dépassement de soi, que ce soit via les sports (arts martiaux, surf, skate) ou dans les challenges intellectuels. C'est ce qui me motive au quotidien !"
    }, {
      "title": "Passionée",
      "ico": "passio",
      "percent": 100,
      "desc": "J'aime imaginer que la passion est quelque chose de collectif et contagieux. On apprends des autres et leurs points de vue créent cette inspiration puis c'est à notre tour de faire éclore les idées chez eux avec cette energie. Durant mes études, j'ai pu apprendre et transmettre grâce au milieu associatif (Ascoergo, FRESCO, Mindlabdx, TEDxUniversitéDeBordeaux et DjangoGirls)"
    }, {
      "title": "Vue d'ensemble",
      "ico": "ovvw",
      "percent": 100,
      "desc": "Avoir une formation pluridisciplinaire (maths, informatique, neurosciences, IHM, recherche, business) m'aide au quotidien à garder la tête froide et considérer les différents élements qui entrent en jeu dans un projet."
    }, {
      "title": "Esprit Critique",
      "ico": "crit",
      "percent": 100,
      "desc": "Le fait de cotoyer deux mondes très différents, celui de la recherche, emprunt de rigueur scientifique et de précision et celui du business ou de l'entrepreneuriat, où sont importantes les compétences orales, marketting, la réactivité et l'esprit de compétition ou même parfois de combativité, m'a permis d'avoir une vue plus générale sur les objectifs et la vision de chacun."
    }, {
      "title": "Humour",
      "ico": "jk",
      "percent": 100,
      "desc": "Que se passe t il quand deux poissons se disputent ? Le thon monte."
    }]
  },
  "bonus": {
    "title": "Et en Bonus...",
    "titleSingular": "bonus",
    "titlePlural": "bonus",
    "maxSelected": 1,
    "data": [{
      "title": "Langues",
      "ico": "lingu",
      "percent": 100,
      "desc": "Le français est ma langue natale et je suis fluide en anglais (Master entierement en anglais, stages et années a l'étranger (UK et Suède), score au toeic 2017: 825/990). J'ai aussi fait du japonais pendant 7 ans (LV3, niveau B1), de l''espagnol pendant 5 ans (LV2, niveau B2), du chinois 1 an (A1) et du suédois 1 an (A1)."
    }, {
      "title": "Musiques Alternatives",
      "ico": "zik",
      "percent": 100,
      "desc": "J'adore découvrir l'histoire de la musique et comment certains genres sont apparus. Tout genre musical, nouveau, étrange, obscur, inconnu, attise ma curiosité et je suis toujours partante pour découvrir de nouveaux artistes ! Parfois je mixe aussi un peu avec mes amis."
    }, {
      "title": "Art & BD",
      "ico": "bd",
      "percent": 100,
      "desc": "J'adore aller passer du temps dans un musée d'art, c'est toujours une source d'inspiration y compris d'un point de vue technologique. J'aime aussi beaucoup la bande dessinée; depuis que j'ai 7 ans, je fais au festival de la BD d'Angoulème ! Cette passion m'est venue jeune car à cet âge je faisais des <a href=\"http://supermoi.blogspot.com\" target=\"_blank\">BD</a> que je vendais chez le libraire de mon quartier ! J'ai gardé cet amour du dessin."
    }, {
      "title": "Surfeuse/Skateuse",
      "ico": "sk8",
      "percent": 100,
      "desc": "Quand je suis loin de l'océan, quand il n'y a pas de vague sur celui ci, je skate. Mon objectif est d'être capable de sauter un (petit) trottoir ou une marche d'escaliers."
    }, {
      "title": "Adoratrice des épinards",
      "ico": "epinar",
      "percent": 100,
      "desc": "Toute sorte d'épinards : Salade d'épinards, tarte aux épinards, épinards à la crème, smoothie aux épinards (oui oui!), lasagnes aux épinards, raviolis ricotta épinards..."
    }, {
      "title": "Fashiontech",
      "ico": "fash",
      "percent": 100,
      "desc": "J'adore vraiment le travail de certains fashion designers comme Clara Daguin, Behnaz Farahi, Lucy McRae or Maiko Takeda; je trouve leur travail innovant et poétique. "
    }]
  }
};

var IdealCandViewModel = (function () {

  function IdealCandViewModel(Db) {

     // deep copy de la base
    this.sections = $.extend(true, {}, Db);
    // les ids des sections
    this.sectionsId = [];

    for (var sid in this.sections) {
      // remplir les ids des sections
      this.sectionsId.push(sid);

      // préparer l'objet de la section
      var section = this.sections[sid];
      // le nombre d'items sélectionnés
      section.numSelected = ko.observable(0);
      // le nombre d'items qu'il faut sélectionner avant de pouvoir passer à l'étape suivante
      section.notSelected = ko.computed(function () { return this.maxSelected - this.numSelected(); }, section);
      // préparer les items de la section
      for (var i = 0; i < section.data.length; i++) {
        section.data[i].sid = sid;
        section.data[i].isSelected = ko.observable(false);
      }
    }

    // l'id de la section en cours
    this.curSid = ko.observable(this.sectionsId[0]);

    // le nombre total d'items qu'il reste avant de pouvoir trouver un candidat
    this.notSelected = ko.computed(function () {
      var n = 0;
      for (var sid in this.sections)
        n += this.sections[sid].notSelected();
      return n;
    }, this);

    var you = getQueryStringValue("com");
    if (you) {
      $(".result .you").text(you);
    }

    // tous les items sélectionnés de toutes les sections
    this.selectedItems = ko.observableArray();

    // résultat
    this.isResult = ko.observable(false);
    this.resultPercent = ko.observable(0);

  }

  // sélectionner un item d'une section
  IdealCandViewModel.prototype.selectItem = function (item, event) {
    var section = this.sections[item.sid];
    if (item.isSelected()) {
      // désélectionner
      section.numSelected(section.numSelected() - 1);
      item.isSelected(false);
    } else if (section.numSelected() < section.maxSelected) {
      // sélectionner
      section.numSelected(section.numSelected() + 1);
      item.isSelected(true);
      // si besoin, aller automatiquement à la section suivante
      if (this.notSelected() === 0) {
        setTimeout(function () { this.findTheCandid(); }.bind(this), 1000);
        return;
      }
      var index = this.sectionsId.indexOf(item.sid);
      if (section.numSelected() === section.maxSelected && index < this.sectionsId.length - 1) {
        setTimeout(function () { this.goToSection(this.sectionsId[index + 1]); }.bind(this), 1000);
      }
    }
  };

  // aller à une section
  IdealCandViewModel.prototype.goToSection = function (sid) {
    if (sid === this.curSid()) return;

    var lastIndex = this.sectionsId.indexOf(this.curSid());
    var index = this.sectionsId.indexOf(sid);
    var lastSid = this.curSid();
    this.curSid(sid);

    // animate titles
    $(".sections-title ." + lastSid).velocity({ width: "7%", color: "#ffffff", colorAlpha: 0 }, 300);
    $(".sections-title ." + sid).velocity({ width: "86%", color: "#ffffff", colorAlpha: 1 }, 300);

    // animate items
    var tx1, tx2;
    if (index > lastIndex) {
      tx1 = "-100%";
      tx2 = "100%";
    } else {
      tx1 = "100%";
      tx2 = "-100%";
    }
    $(".sections ." + lastSid).velocity({ translateX: tx1, opacity: 0 }, { duration: 300, display: "none" });
    $(".sections ." + sid).velocity({ translateX: tx2 }, 0).velocity({ translateX: "0", opacity: 1 }, { duration: 300, display: "block" });
  };


  IdealCandViewModel.prototype.findTheCandid = function () {

    this.isResult(true);

    var sum = 0;
    this.selectedItems.removeAll();

    for (var sid in this.sections)
      for (var i = 0; i < this.sections[sid].data.length; i++)
        if (this.sections[sid].data[i].isSelected()) {
          this.selectedItems.push(this.sections[sid].data[i]);
          if (sid === "skills")
            sum += this.sections[sid].data[i].percent;
        }

    this.resultPercent(Math.round(sum / this.sections.skills.numSelected()));

    // les data de jquery sont inmemory et les resets ne marchent pas avec ko
    $(".result .circle")
      .data("percent", this.resultPercent())
      .data("text", this.resultPercent() + "%")
      .html("");

    $(".circle").circliful();

    $(document).scrollTo($(".resume"), 500, { easing: "swing" });
  };


  IdealCandViewModel.prototype.scrollToTest = function () {
    $(document).scrollTo($(".sections-title"), 500, { easing: "swing" });
  };


  IdealCandViewModel.prototype.restart = function () {
    this.scrollToTest();
    setTimeout(function () {
      this.isResult(false);
      for (var sid in this.sections) {
        this.sections[sid].numSelected(0);
        for (var i = 0; i < this.sections[sid].data.length; i++) {
          this.sections[sid].data[i].isSelected(false);
        }
      }
      this.goToSection("skills");
    }.bind(this), 550);
  };


  IdealCandViewModel.prototype.sendEmail = function (data) {
    var frm = $(data);

    if ($("input[name='name']", frm).val() === "" ||
      $("input[name='email']", frm).val() === "" ||
      $("input[name='sujet']", frm).val() === "" ||
      $("textarea[name='body']", frm).val() === "")
      return;

    $(":submit", frm).attr("disabled", true);
    
    grecaptcha.render("recaptcha", {
      "sitekey" : "6LfqtB4UAAAAACXoXRhjmb1J3aDaqfybIbDJo3X4",
      "callback" : function () {
        $.ajax({
          url: frm.attr("action"),
          type: "post",
          data: frm.serialize()
        }).done(function () {
          $('#contactModal').modal("hide");
        }).fail(function () {
          alert("Une erreur est survenue lors d'envoi !");
        }).always(function () {
          $(":submit", frm).attr("disabled", false);
        });
      }
    });
  };


  function getQueryStringValue(name) {
    name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
    var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
      results = regex.exec(location.search);
    return results === null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
  }


  return IdealCandViewModel;

})();